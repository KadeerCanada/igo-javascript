<!DOCTYPE HTML>
<html><!-- manifest="cache.manifest"-->
<title>Igo for Javascript のテスト</title>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

<script>
igo = {};
</script>
<script src="util.js"></script>
<script src="trie.js"></script>
<script src="dictionary.js"></script>
<script src="tagger.js"></script>

<script>
$(function() {
	var tagger = undefined;
	var word2id, worddat, wordary, wordinf, matrix;
	
	function complete() {
		if(!(word2id && worddat && wordary && wordinf && matrix)) return;
		var wdc = new igo.WordDic(word2id, worddat, wordary, wordinf);
		var mtx = new igo.Matrix(matrix);
		tagger = new igo.Tagger(wdc, undefined, mtx);
		
		$('#loading').hide();
		$('#inputform').show();
	}
	
	var test = igo.getServerFileToArrayBufffer('./ipadic/word2id', function(buffer) {
		word2id = buffer;
		complete();
		$('<div>単語ID辞書のダウンロード完了</div>').appendTo($('#loading'));
	});
	igo.getServerFileToArrayBufffer('./ipadic/word.dat', function(buffer) {
		worddat = buffer;
		complete();
	});
	igo.getServerFileToArrayBufffer('./ipadic/word.ary.idx', function(buffer) {
		wordary = buffer;
		complete();
		$('<div>単語インデックスのダウンロード完了</div>').appendTo($('#loading'));
	});
	igo.getServerFileToArrayBufffer('./ipadic/word.inf', function(buffer) {
		wordinf = buffer;
		complete();
		$('<div>単語情報のダウンロード完了</div>').appendTo($('#loading'));
	});
	igo.getServerFileToArrayBufffer('./ipadic/matrix.bin', function(buffer) {
		matrix = buffer;
		complete();
		$('<div>隣接コストのダウンロード完了</div>').appendTo($('#loading'));
	});
	
	$('#morph').click(function() {
		var nodes = tagger.parse($('#input').val());
		var result = '';
		for(var i=0;i<nodes.length;i++) {
			result += '<div class="morph"><div class="surface">' + nodes[i].surface + '</div><div class="feature">' + nodes[i].feature + '</div></div>'
		}
		$('#result').html(result);
	});
});
</script>
<style type="text/css">
<!--
#inputform {
	display:none;
}
div.morph {
	display:table-row;
}
div.surface {
	display:table-cell;
	width:100px;
}
div.feature {
	display:table-cell;
}
#input {
	width:400px;
}
-->
</style>
<body>
<div id="loading">
辞書をダウンロード中・・・しばらくお待ち下さい。
</div>
<div id="inputform">
<div>形態素解析したいテキストを入力してボタンを押してね</div>
<input type="text" id="input" value="">
<input type="button" id="morph" value="形態素解析">
<div id="result">
</div>
</div>
</body>
</html>
